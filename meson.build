project('krkrsdl2', ['c', 'cpp'], default_options: ['optimization=3', 'debug=true', 'warning_level=1'], version: 'unknown')

cxx = meson.get_compiler('cpp')
host_system = host_machine.system()

freetype2_dep = dependency('freetype2', method: 'auto')
libpng_dep = dependency('libpng', method: 'auto')
libjpeg_dep = dependency('libjpeg', method: 'auto')
oniguruma_dep = dependency('oniguruma', method: 'auto')
opusfile_dep = dependency('opusfile', method: 'auto')
sdl2_dep = dependency('sdl2', method: 'auto')
zlib_dep = dependency('zlib', method: 'auto')

krkrsdl2_src = [
	'external/krkrz/base/BinaryStream.cpp',
	'external/krkrz/base/CharacterSet.cpp',
	'external/krkrz/base/EventIntf.cpp',
	'external/krkrz/base/PluginIntf.cpp',
	'external/krkrz/base/ScriptMgnIntf.cpp',
	'external/krkrz/base/StorageIntf.cpp',
	'external/krkrz/base/SysInitIntf.cpp',
	'external/krkrz/base/SystemIntf.cpp',
	'external/krkrz/base/TextStream.cpp',
	'external/krkrz/base/UtilStreams.cpp',
	'external/krkrz/base/XP3Archive.cpp',
	'external/krkrz/base/stub/FileSelector.cpp',
	'external/krkrz/base/stub/ScriptMgnImpl.cpp',
	'external/krkrz/base/win32/EventImpl.cpp',
	'external/krkrz/extension/Extension.cpp',
	'external/krkrz/msg/MsgIntf.cpp',
	'external/krkrz/msg/win32/MsgImpl.cpp',
	'external/krkrz/sound/MathAlgorithms.cpp',
	'external/krkrz/sound/OpusCodecDecoder.cpp',
	'external/krkrz/sound/PhaseVocoderDSP.cpp',
	'external/krkrz/sound/PhaseVocoderFilter.cpp',
	'external/krkrz/sound/RealFFT.cpp',
	'external/krkrz/sound/SoundBufferBaseImpl.cpp',
	'external/krkrz/sound/SoundBufferBaseIntf.cpp',
	'external/krkrz/sound/WaveFormatConverter.cpp',
	'external/krkrz/sound/WaveIntf.cpp',
	'external/krkrz/sound/WaveLoopManager.cpp',
	'external/krkrz/sound/WaveSegmentQueue.cpp',
	'external/krkrz/sound/win32/WaveImpl.cpp',
	'external/krkrz/tjs2/tjs.cpp',
	'external/krkrz/tjs2/tjs.tab.cpp',
	'external/krkrz/tjs2/tjsArray.cpp',
	'external/krkrz/tjs2/tjsBinarySerializer.cpp',
	'external/krkrz/tjs2/tjsByteCodeLoader.cpp',
	'external/krkrz/tjs2/tjsCompileControl.cpp',
	'external/krkrz/tjs2/tjsConfig.cpp',
	'external/krkrz/tjs2/tjsConstArrayData.cpp',
	'external/krkrz/tjs2/tjsDate.cpp',
	'external/krkrz/tjs2/tjsDateParser.cpp',
	'external/krkrz/tjs2/tjsDebug.cpp',
	'external/krkrz/tjs2/tjsDictionary.cpp',
	'external/krkrz/tjs2/tjsDisassemble.cpp',
	'external/krkrz/tjs2/tjsError.cpp',
	'external/krkrz/tjs2/tjsException.cpp',
	'external/krkrz/tjs2/tjsGlobalStringMap.cpp',
	'external/krkrz/tjs2/tjsInterCodeExec.cpp',
	'external/krkrz/tjs2/tjsInterCodeGen.cpp',
	'external/krkrz/tjs2/tjsInterface.cpp',
	'external/krkrz/tjs2/tjsLex.cpp',
	'external/krkrz/tjs2/tjsMT19937ar-cok.cpp',
	'external/krkrz/tjs2/tjsMath.cpp',
	'external/krkrz/tjs2/tjsMessage.cpp',
	'external/krkrz/tjs2/tjsNamespace.cpp',
	'external/krkrz/tjs2/tjsNative.cpp',
	'external/krkrz/tjs2/tjsObject.cpp',
	'external/krkrz/tjs2/tjsObjectExtendable.cpp',
	'external/krkrz/tjs2/tjsOctPack.cpp',
	'external/krkrz/tjs2/tjsRandomGenerator.cpp',
	'external/krkrz/tjs2/tjsRegExp.cpp',
	'external/krkrz/tjs2/tjsScriptBlock.cpp',
	'external/krkrz/tjs2/tjsScriptCache.cpp',
	'external/krkrz/tjs2/tjsSnprintf.cpp',
	'external/krkrz/tjs2/tjsString.cpp',
	'external/krkrz/tjs2/tjsUtils.cpp',
	'external/krkrz/tjs2/tjsVariant.cpp',
	'external/krkrz/tjs2/tjsVariantString.cpp',
	'external/krkrz/tjs2/tjsdate.tab.cpp',
	'external/krkrz/tjs2/tjspp.tab.cpp',
	'external/krkrz/utils/ClipboardIntf.cpp',
	'external/krkrz/utils/DebugIntf.cpp',
	'external/krkrz/utils/MiscUtility.cpp',
	'external/krkrz/utils/Random.cpp',
	'external/krkrz/utils/TVPTimer.cpp',
	'external/krkrz/utils/ThreadIntf.cpp',
	'external/krkrz/utils/TickCount.cpp',
	'external/krkrz/utils/TimerIntf.cpp',
	'external/krkrz/utils/TimerThread.cpp',
	'external/krkrz/utils/VelocityTracker.cpp',
	'external/krkrz/utils/cp932_uni.cpp',
	'external/krkrz/utils/md5.c',
	'external/krkrz/utils/uni_cp932.cpp',
	'external/krkrz/utils/win32/ClipboardImpl.cpp',
	'external/krkrz/visual/BitmapIntf.cpp',
	'external/krkrz/visual/BitmapLayerTreeOwner.cpp',
	'external/krkrz/visual/CharacterData.cpp',
	'external/krkrz/visual/ComplexRect.cpp',
	'external/krkrz/visual/DrawDevice.cpp',
	'external/krkrz/visual/FontSystem.cpp',
	'external/krkrz/visual/FreeType.cpp',
	'external/krkrz/visual/FreeTypeFontRasterizer.cpp',
	'external/krkrz/visual/GraphicsLoadThread.cpp',
	'external/krkrz/visual/GraphicsLoaderIntf.cpp',
	'external/krkrz/visual/ImageFunction.cpp',
	'external/krkrz/visual/LayerBitmapImpl.cpp',
	'external/krkrz/visual/LayerBitmapIntf.cpp',
	'external/krkrz/visual/LayerIntf.cpp',
	'external/krkrz/visual/LayerManager.cpp',
	'external/krkrz/visual/LayerTreeOwnerImpl.cpp',
	'external/krkrz/visual/LoadJPEG.cpp',
	'external/krkrz/visual/LoadPNG.cpp',
	'external/krkrz/visual/LoadTLG.cpp',
	'external/krkrz/visual/NullDrawDevice.cpp',
	'external/krkrz/visual/PrerenderedFont.cpp',
	'external/krkrz/visual/RectItf.cpp',
	'external/krkrz/visual/SaveTLG5.cpp',
	'external/krkrz/visual/SaveTLG6.cpp',
	'external/krkrz/visual/TransIntf.cpp',
	'external/krkrz/visual/VideoOvlIntf.cpp',
	'external/krkrz/visual/WindowIntf.cpp',
	'external/krkrz/visual/gl/ResampleImage.cpp',
	'external/krkrz/visual/gl/WeightFunctor.cpp',
	'external/krkrz/visual/gl/blend_function.cpp',
	'external/krkrz/visual/tvpgl.c',
	'external/krkrz/visual/win32/BasicDrawDevice.cpp',
	'external/krkrz/visual/win32/BitmapBitsAlloc.cpp',
	'external/krkrz/visual/win32/BitmapInfomation.cpp',
	'external/krkrz/visual/win32/GraphicsLoaderImpl.cpp',
	'external/krkrz/visual/win32/LayerImpl.cpp',
	'external/krkrz/visual/win32/TVPScreen.cpp',
	'external/krkrz/visual/win32/VideoOvlImpl.cpp',
	'external/krkrz/visual/win32/WindowImpl.cpp',
	'src/core/base/sdl2/NativeEventQueue.cpp',
	'src/core/base/sdl2/PluginImpl.cpp',
	'src/core/base/sdl2/StorageImpl.cpp',
	'src/core/base/sdl2/SysInitImpl.cpp',
	'src/core/base/sdl2/SystemImpl.cpp',
	'src/core/environ/sdl2/Application.cpp',
	'src/core/environ/sdl2/SystemControl.cpp',
	'src/core/sdl2/SDLApplication.cpp',
	'src/core/sound/sdl2/WaveMixer.cpp',
	'src/plugins/InternalPlugins.cpp',
	'src/plugins/KAGParser.cpp',
	'src/plugins/csvParser.cpp',
	'src/plugins/fftgraph.cpp',
	'src/plugins/getSample.cpp',
	'src/plugins/ncbind/ncbind.cpp',
	'src/plugins/saveStruct.cpp',
	'src/plugins/varfile.cpp',
	'src/plugins/win32dialog.cpp',
	'src/plugins/wutcwf.cpp',
]
krkrsdl2_includes = [
	'src/core/base/sdl2',
	'src/core/environ/sdl2',
	'src/core/sound/sdl2',
	'external/krkrz',
	'external/krkrz/base',
	'external/krkrz/base/android',
	'external/krkrz/base/stub',
	'external/krkrz/base/win32',
	'external/krkrz/environ',
	'external/krkrz/environ/win32',
	'external/krkrz/environ/android',
	'external/krkrz/extension',
	'external/krkrz/msg',
	'external/krkrz/msg/win32',
	'external/krkrz/sound',
	'external/krkrz/sound/win32',
	'external/krkrz/tjs2',
	'external/krkrz/utils',
	'external/krkrz/utils/win32',
	'external/krkrz/visual',
	'external/krkrz/visual/gl',
	'external/krkrz/visual/win32',
	'src/plugins',
]
krkrsdl2_cflags = []
krkrsdl2_cflags += [
	'-DTVP_OPUS_DECODER_IMPLEMENT',
]
krkrsdl2_cppflags = []
krkrsdl2_cppflags += krkrsdl2_cflags
krkrsdl2_cppflags += ['-std=c++11']
if cxx.get_id() == 'gcc'
	krkrsdl2_cppflags += ['-fno-delete-null-pointer-checks']
endif
krkrsdl2_ldflags = []
if target_machine.system() == 'linux'
	krkrsdl2_ldflags += ['-pthread']
endif
krkrsdl2_dependson = [
	freetype2_dep,
	libpng_dep,
	libjpeg_dep,
	oniguruma_dep,
	opusfile_dep,
	sdl2_dep,
	zlib_dep,
]
krkrsdl2 = executable('krkrsdl2', sources: krkrsdl2_src, c_args: krkrsdl2_cflags, cpp_args: krkrsdl2_cppflags, link_args: krkrsdl2_ldflags, include_directories: include_directories(krkrsdl2_includes), dependencies: krkrsdl2_dependson, install: true)
